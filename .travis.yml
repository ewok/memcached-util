language: go
go: 1.11.x
services:
- docker
- redis-server
env:
  global:
  - secure: bOJD194hcrEFYWRJP8acA+d0oyNw2me5jzbt0Rh6eBweH27rwYYrm3IyXESmfmGcdHxAL8SNRvpufsAqKMuNChP2MZBPXxlfuQhjIxZB9r1GBZH5dGOPFVCIsbMdYt8ZRsf1PwhFUvoTzJ8kYrOk/a0M5dZeGjBALGneP7Vv5MQLc7pDlA/xU0CeAJEL6w3OYsSgDMPjDa375XMXhE52Op/RSEt3w0CZKZ8/9lp4efArwt2IPq30UrmdtSbdHhaAVw37OwIy/7EwGVJcz4Hhh5sUvzHng0yxTGqn9MmY7R+Yk5A4WnCOT1Dkta8JPx3AgYd38bgAjhVpZ27zBfPdrETfN2NDNLOekUpPtQPCqoOvTUx4nLGFMdwYG6ix0NZdP52/gPnNfUFwuR08TjDEIXRiUo84ZA3s9Cfo/e7Ai83XjqvW5PuWNAXUewDPkGS0l7aGzKjMbWAe7PZ2qM8JSOJD2Jb1btqkgURKJuzlszuyo6W0vtJP6uifVe5yex/AZPbbAUh9y72wXuI4Hj3WCNDipgdRWZdiLuxAJZr13KVwDW5fjsQMbTccjvGfm4Rl0B/F6CY5Beh3Mld72un8mY7eUHdYsQQVydMNP7+PRMIFqZl0NUoH3xlZBqz8Lz2JQ5cbozLCx380/x05ZhpwMnznQLG0E2ARyQra7preCQY=
  - secure: ml3DTsUscWitVnvC8hHb4cyjqck/G6XIREuy7oCrt9mmUPERHgQHpUGQDaAUlO+UuumZufthWzo5280xaNSOMS/XJ78sx3r1FLl1/3d7uFAc/jAEeJzdff0Fd1Fq02QaTAPm74HkwY9uAGOiEdcmwaHofbxycIsPmv6BrxUbSap4/ndxqLbKGzUCiyZCS0ajDkXOVTnwuTO6aFahqokvR7RQfvwuOcMRuGlEys5JOVbVX3gO8pqQaSt7R2r+gTW8DQe+h3s6L3vAXBaUKOUqgBM8N/exxWE5652ggxEyVmV6ecFer+QSWUIAxceqm0LsR1sUNeAMHO98f1M5S+m8wjIDpWsvufRukGysywQ7DBVTcWs+kFs9JjTjJqkms27V9WShKhx1TjpCtss5cw9BCQblbpYrGW8O1+hgiKsBprroHdIUGVqVX3kgiGumkIfHX5SthzF/vZIwJzYANy3VftrgM3EhPJbvfoY4KFJEi0m90bEZ4mAn9S6Q8rjQom1rGRn5ltXEfcWFrA8n8ZbqPWihw7rB0JLLvN6MPB0OFlxGe7WV+5v8yG0q9guOobR+4StV5+28hnN1mf6pehB6LIjXCvkkxm57jesX06abeMh0QNA92Qo1fMPgSyk0JErrLzboPwH+mahMu7K6JXZEoYib4hSI9oQOncvz5W5fh9s=
  - secure: XUQyt9ix2jCpn/jrzBcfJ5Le5wDYtKQZzPgBLjcFQONz3d6sUbOHbf/MX3yxKVIk5AygkJlldVLFzLHG4QmElvU9JX2vtJxzLD3EmZIvZJ39DLcPcy3Md2UkhVU9D16em4qb3rw0RpQxOeyLQla5tI/nfoM5UACwsQF+4VicaH/J3QPvHwQK2jfaoOBSOGCCIjQ4xDO6OLcmABT9gbZl0S6XR6cAUc8vIXE1e6Aizye8lApPDgLE1DRDXnTTjJDaItIDn+i6XBDeqQS9Yk13QhaHvxBoHSEfP0qbuPbl5nH72X8PrW1QwB/Dm9CjfScyCSkvMxqfwa54sQqlBkJVzqyaHIoSLh9dMsQI0mSjvUKMM2RQRpsyRRuc86IOMN2Q+cAgHOuhxyAc7qoaujOmBItw+v4D+5dg8ug0rCXHeRMFbNR7FQE0QDYv1vl0nOj07e1kjdl7IKMtDj6nUxKpoPI3KFuYBXAHW2onL5G5l3k7wApHeM07j29yYCSNI7rRcSZa1YC7QiHVU+zuMeNB3Asszj5EBIh1NEqvS/ql0AsZ4dCusqYNPflY4sUSG8B3n4YYaHRkIWCx35+9/hXWgkrsnZx4et6C9LN0qCRO+6yDUOtzdXsNeeMmWigaZ+Y37+n04+nKBOInILMNYmGIBzjtscN3/DRwj738q4vxkTA=
  - secure: XmORQONfhnVXlIH24iOxpL7+V0pC/+9LpNliL8zg+XIFzVH4CHFTkqHiEu596W1zdZ9gXfcaJgrBWiJfzTFXriwHmlmWtmSMxg2rl5JzxOPnjNgepHU6rofS1NK8id4StgxvW8mwonZ12LaZTOCD+q6p30IXCMP1+nvnhUNqucdRHD3Cw1rufgb/Q9LjKwZ2lyn10IbwFmOzzKLvwWaAqpys3tOtqxFLvd9c6VTrTvZr8SUt4Z8AbhjOSFtCM7fgxFMpDliPoQ3I+SzBrotL26ibcWUR43IxaeYvVxPm1lgYl18e+/BT3rTLGJZXsWDw/nckUsyT+dpW7jzlYHH07eStH4N1o2eHupwvg5yLNxB8t2KBzxhRzcKZ6+nR9c/zMs2qfQlrA3lf+DdmArIOnmLDhkfHK054lTjhrsKF5uvY3dSn3eFrZE7DRePq5JyO9Vmk5APO02GqeZhDp6xMMimDdKulYJtWp1b/scE30gG7vsawbVJfNQuIWa2hdxUhWnmclDE2Lz7xmgrF9NIHywKwv+Ixz8Eq0+jSzskqCOJIcOQW+ZtTeq0bfb2gmcQEolDKr8T6IfnwhkN+pySKGatIAmUdvLo1PSqzyzv7VQQkKxJWdbPbms+V2OJvrSlRrLvRU59mq7j7JwerhkVita03fPLv3Ye8BNNBe8w0H7Q=
before_install:
- export COVERALLS_PARALLEL=true
- export GOMAXPROCS=1
- export GITHUB_TOKEN=$GITHUB_TOKEN_RELEASE
- go get github.com/mattn/goveralls
script:
- make test-docker
- "$GOPATH/bin/goveralls -repotoken $COVERALLS -coverprofile=profile.cov -service=travis-ci"
- make build
- test -f bin/linux-amd64/util
- make container
- docker images | grep meio/memcached-util
deploy:
- provider: script
  skip_cleanup: true
  script: "./scripts/build-docker.sh"
  on:
    tags: true
    condition: "$TRAVIS_OS_NAME = linux"
- provider: script
  skip_cleanup: true
  script: curl -sL https://git.io/goreleaser | bash
  on:
    tags: true
    condition: "$TRAVIS_OS_NAME = linux"
notifications:
  webhooks:
    urls: https://coveralls.io/webhook?repo_token=$COVERALLS
